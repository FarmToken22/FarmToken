<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Withdraw | FarmToken</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background-color: #f9fafb;
      min-height: 100vh;
    }
    .coming-soon {
      filter: blur(1px);
      opacity: 0.5;
      pointer-events: none;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }
    .notification.show {
      opacity: 1;
    }
    .fade-in { 
      animation: fadeIn 0.4s ease; 
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .loading { 
      text-align: center; 
      padding: 40px; 
    }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }

    .ad-container {
      min-height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f9fafb;
      border-radius: 8px;
      padding: 10px;
      margin: 16px 0;
      width: 100%;
    }
    .ad-section {
      width: 100%;
      display: none;
    }
    .ad-section.visible {
      display: block;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex items-center justify-between px-6 py-4 shadow bg-white sticky top-0 z-10">
    <div class="flex items-center gap-3">
      <img src="Logo.png" alt="FarmToken Logo" class="h-10 w-10 object-contain"
        onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2240%22 fill=%22%2328a745%22/></svg>'">
      <h1 class="text-2xl font-bold text-red-600">FarmToken</h1>
    </div>
    <button onclick="window.location.href='index.html'" class="flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-teal-400 text-white hover:from-green-600 hover:to-teal-500 transition-all">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
    </button>
  </header>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <!-- Withdraw Section -->
  <main class="flex-1 flex flex-col items-center p-4 max-w-md mx-auto w-full fade-in">
    <div id="loading-state" class="loading">
      <div class="spinner"></div>
      <p class="text-gray-600">Loading your account...</p>
    </div>

    <div id="withdraw-content" style="display: none;" class="w-full">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Withdraw Funds</h2>

      <!-- Ad Space 1 -->
      <div id="adSpace1" class="ad-section">
        <div class="ad-container">
          <div class="spinner"></div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow p-5 w-full space-y-4">
        <div>
          <label class="block text-gray-600 text-sm font-semibold mb-1">Available Balance</label>
          <p id="availableBalance" class="text-green-600 font-bold text-lg">0.00 FT</p>
        </div>

        <div class="coming-soon">
          <label class="block text-gray-600 text-sm font-semibold mb-1">Withdraw Amount (FT)</label>
          <input type="number" placeholder="Enter amount" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" disabled />
        </div>

        <div class="coming-soon">
          <label class="block text-gray-600 text-sm font-semibold mb-1">Wallet Address</label>
          <input type="text" placeholder="Enter wallet address" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" disabled />
        </div>

        <button id="withdrawBtn" class="w-full py-3 bg-gray-400 text-white rounded-lg font-semibold cursor-not-allowed">
          Withdraw (Coming Soon)
        </button>
      </div>

      <!-- Ad Space 2 -->
      <div id="adSpace2" class="ad-section">
        <div class="ad-container">
          <div class="spinner"></div>
        </div>
      </div>

      <!-- Coming Soon Features -->
      <div class="mt-8 w-full space-y-4">
        <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center opacity-60">
          <span class="font-semibold text-gray-700">Withdraw History</span>
          <span class="text-xs bg-yellow-400 text-white px-2 py-1 rounded-lg">Coming Soon</span>
        </div>

        <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center opacity-60">
          <span class="font-semibold text-gray-700">Convert FT to USDT</span>
          <span class="text-xs bg-yellow-400 text-white px-2 py-1 rounded-lg">Coming Soon</span>
        </div>

        <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center opacity-60">
          <span class="font-semibold text-gray-700">Auto Withdraw System</span>
          <span class="text-xs bg-yellow-400 text-white px-2 py-1 rounded-lg">Coming Soon</span>
        </div>
      </div>

      <!-- Ad Space 3 -->
      <div id="adSpace3" class="ad-section">
        <div class="ad-container">
          <div class="spinner"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 py-3 text-center text-xs text-gray-500 mt-8">
    Â© 2025 FarmToken | All Rights Reserved
  </footer>

  <script type="module">
    // âœ… config.js à¦¥à§‡à¦•à§‡ import à¦•à¦°à§à¦¨ (Firebase initialization à¦¬à¦¾à¦°à¦¬à¦¾à¦° à¦¹à¦¬à§‡ à¦¨à¦¾)
    import { auth, database } from './config.js';
    import { ref, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    // Multiple ad spaces configuration
    const adConfigs = [
      { 
        id: 'adSpace1',
        key: '78ade24182729fceea8e45203dad915b', 
        format: 'iframe', 
        height: 50, 
        width: 320, 
        src: '//www.highperformanceformat.com/78ade24182729fceea8e45203dad915b/invoke.js' 
      },
      { 
        id: 'adSpace2',
        key: '78ade24182729fceea8e45203dad915b', 
        format: 'iframe', 
        height: 50, 
        width: 320, 
        src: '//www.highperformanceformat.com/78ade24182729fceea8e45203dad915b/invoke.js' 
      },
      { 
        id: 'adSpace3',
        key: '78ade24182729fceea8e45203dad915b', 
        format: 'iframe', 
        height: 50, 
        width: 320, 
        src: '//www.highperformanceformat.com/78ade24182729fceea8e45203dad915b/invoke.js' 
      }
    ];

    let userData = null;
    let userId = null;
    let currentAdIndex = 0;

    const availableBalance = document.getElementById("availableBalance");
    const withdrawBtn = document.getElementById("withdrawBtn");
    const notification = document.getElementById("notification");
    const loadingState = document.getElementById("loading-state");
    const withdrawContent = document.getElementById("withdraw-content");

    function showNotification(message, color = "green") {
      notification.textContent = message;
      notification.style.background = color === "green" ? "#28a745" : "#dc3545";
      notification.classList.add("show");
      setTimeout(() => notification.classList.remove("show"), 2500);
    }

    withdrawBtn.addEventListener("click", () => {
      showNotification("ðŸ’¡ Withdraw feature coming soon!", "green");
    });

    // --- Ad Loading Logic ---
    function loadRandomAd() {
      // Hide all ads first
      adConfigs.forEach(config => {
        const adSpace = document.getElementById(config.id);
        if (adSpace) adSpace.classList.remove('visible');
      });

      // Pick a random ad to show
      currentAdIndex = Math.floor(Math.random() * adConfigs.length);
      const selectedAd = adConfigs[currentAdIndex];
      const adSpace = document.getElementById(selectedAd.id);
      
      if (!adSpace) return;

      const container = adSpace.querySelector('.ad-container');
      if (!container) return;

      container.innerHTML = '';
      const script1 = document.createElement('script');
      script1.type = 'text/javascript';
      script1.innerHTML = `atOptions = {'key': '${selectedAd.key}','format': '${selectedAd.format}','height': ${selectedAd.height},'width': ${selectedAd.width},'params': {}};`;
      
      const script2 = document.createElement('script');
      script2.type = 'text/javascript';
      script2.src = selectedAd.src;
      
      container.appendChild(script1);
      container.appendChild(script2);
      
      // Show the selected ad
      adSpace.classList.add('visible');
    }

    // Rotate ads every 30 seconds
    function startAdRotation() {
      loadRandomAd();
      setInterval(loadRandomAd, 30000); // 30 seconds
    }

    // --- Core Application Logic ---
    auth.onAuthStateChanged((user) => {
      if (user) {
        userId = user.uid;
        loadUserData();
        startAdRotation();
      } else {
        window.location.href = 'index.html';
      }
    });

    async function loadUserData() {
      try {
        const userRef = ref(database, 'users/' + userId);
        const snapshot = await get(userRef);
        
        if (snapshot.exists()) {
          userData = snapshot.val();
          displayBalance();
        } else {
          console.error('User data not found');
          showNotification("Error loading account data", "red");
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        showNotification("Error loading account data", "red");
      }
    }

    function displayBalance() {
      loadingState.style.display = 'none';
      withdrawContent.style.display = 'block';
      
      if (userData && availableBalance) {
        availableBalance.textContent = (userData.balance || 0).toFixed(2) + " FT";
      }
    }
  </script>

</body>
</html>